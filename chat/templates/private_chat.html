<!-- In your private_chat.html file -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Private Chat</title>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>
<body>

<h2>Private Chat</h2>
<div id="chat-messages">
    {% for message in messages %}
        {{ render_message(message) }}
    {% endfor %}
</div>
<form id="message-form">
    {% csrf_token %}
    <input type="text" id="message-input" name="content" required>
    <button type="button" onclick="sendMessage()">Send</button>
</form>
<script>
    function sendMessage() {
        var content = document.getElementById('message-input').value;
        if (content.trim() !== '') {
            $.ajax({
                url: '{% url "send_message" chat.id %}',
                method: 'POST',
                data: { content: content },
                success: function(data) {
                    appendMessage(data);
                    document.getElementById('message-input').value = '';
                }
            });
        }
    }

    function appendMessage(messageData) {
        $('#chat-messages').append(render_message(messageData));
    }

    function render_message(messageData) {
        return '<p data-message-id="' + messageData.id + '">' + messageData.sender + ' (' + messageData.timestamp + '): ' + messageData.content + '</p>';
    }

    function getMessages() {
        var lastMessageId = $('#chat-messages p:last').data('message-id') || 0;

        $.ajax({
            url: '{% url "get_messages" chat.id %}',
            method: 'GET',
            data: { last_message_id: lastMessageId },
            success: function(data) {
                data.messages.forEach(function(message) {
                    appendMessage(message);
                });
            }
        });
    }

    // Poll for new messages every 5 seconds (adjust as needed)
    setInterval(getMessages, 5000);
</script>
</body>
</html>
